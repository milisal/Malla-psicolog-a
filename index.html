<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Malla Curricular Psicología</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-color: #fff6f8;
      --column-bg: #ffeef4;
      --border-color: #e7b6c7;
      --primary-text: #78244c;
      --course-bg: #fbdde7;
      --completed-bg: #e2f5e9;
      --locked-bg: #f8d2da;
      --tooltip-bg: #c94a63;
      --check-color-light: #b3365c; /* rosa intenso claro */
    }

    body.dark-mode {
      --bg-color: #3b0a28;
      --column-bg: #4d0f35;
      --border-color: #72254c;
      --primary-text: #ffeaf3;
      --course-bg: #7c2947;
      --completed-bg: #4a5a4f;
      --locked-bg: #723244;
      --tooltip-bg: #ae3658;
      --check-color-dark: #7a1839; /* bordo intenso oscuro */
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      padding: 20px;
      color: var(--primary-text);
      transition: background-color 0.3s ease, color 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      padding-top: 70px; /* espacio para botón fijo */
    }

    h1 {
      text-align: center;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .toggle-container {
      position: fixed;
      top: 20px;
      right: 20px;
      margin-bottom: 0;
      z-index: 1000;
    }

    .toggle-container button {
      padding: 8px 16px;
      background-color: var(--tooltip-bg);
      color: white;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s;
    }

    .toggle-container button:hover {
      background-color: #a23650;
    }

    .progress {
      text-align: center;
      margin-bottom: 30px;
      font-size: 1rem;
      font-weight: 600;
    }

    .grid {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding: 10px 0;
      max-width: 1200px;
      justify-content: center;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .column {
      flex: 0 0 auto;
      background-color: var(--column-bg);
      border-radius: 16px;
      padding: 16px;
      min-width: 250px;
      border: 2px solid var(--border-color);
      box-sizing: border-box;
      color: var(--primary-text);
      transition: background-color 0.3s, border-color 0.3s, color 0.3s;
    }

    /* Colores oscuros para columnas principales */
    .column.cbc {
      background-color: #d17a91;
      border-color: #b74e69;
      color: white;
    }
    .column.formacion-general {
      background-color: #ca7891;
      border-color: #a14663;
      color: white;
    }
    .column.formacion-profesional {
      background-color: #b66584;
      border-color: #8d3a57;
      color: white;
    }
    .column.requisitos-de-tesis {
      background-color: #a45174;
      border-color: #76284a;
      color: white;
    }

    .column h2 {
      text-align: center;
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .course {
      background-color: var(--course-bg);
      border-radius: 12px;
      padding: 10px;
      margin: 8px 0;
      position: relative;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid var(--border-color);
      transition: background 0.2s, color 0.2s;
      color: var(--primary-text);
      user-select: none;
    }

    .course.completed {
      background-color: var(--completed-bg);
      text-decoration: line-through;
      /* color del texto no cambia aquí para mantener contraste */
    }

    .course.locked {
      background-color: var(--locked-bg);
      opacity: 0.7;
      cursor: default;
      color: #999;
      border-color: #ccc;
    }

    .course .tooltip {
      visibility: hidden;
      opacity: 0;
      background-color: var(--tooltip-bg);
      color: white;
      padding: 6px 12px;
      border-radius: 999px;
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      white-space: nowrap;
      transition: opacity 0.3s;
      font-size: 0.8rem;
      z-index: 10;
      pointer-events: none;
    }

    .course:hover .tooltip {
      visibility: visible;
      opacity: 1;
    }

    .checkmark {
      float: right;
      font-weight: bold;
      user-select: none;
      color: var(--check-color-light);
      transition: color 0.3s;
    }

    body.dark-mode .checkmark {
      color: var(--check-color-dark);
    }
  </style>
</head>
<body>
  <div class="toggle-container">
    <button id="darkModeBtn">Alternar modo oscuro</button>
  </div>

  <h1>Malla Curricular – Lic. en Psicología</h1>
  <div class="progress" id="tesisProgress"></div>
  <div class="grid" id="curriculum"></div>

  <script>
    const data = {
      'CBC': [
        'Biología', 'Semiología', 'Psicología', 'Pensamiento científico', 'Matemática', 'Sociedad y Estado'
      ],
      'Formación General': [
        { name: 'Psicología General', reqs: ['CBC'] },
        { name: 'Estadística', reqs: ['CBC'] },
        { name: 'Psicología Social', reqs: ['CBC'] },
        { name: 'Psicoanálisis Freud', reqs: ['CBC'] },
        { name: 'Psic. Y Epist. Genética', reqs: ['CBC'] },
        { name: 'Neurofisiología', reqs: ['CBC'] },
        { name: 'Historia de la Psicología', reqs: ['Psicología General'] },
        { name: 'Metodología de la Investigación', reqs: ['Psicología General', 'Estadística'] },
        { name: 'Salud Pública y Mental', reqs: ['Psicología Social', 'Metodología de la Investigación'] },
        { name: 'Teoría y Técnica de Grupos', reqs: ['Psicología Social', 'Psicoanálisis Freud'] },
        { name: 'Ps. Evolutiva Niñez', reqs: ['Psicoanálisis Freud', 'Psic. Y Epist. Genética'] },
        { name: 'Ps. Evolutiva Adolescencia', reqs: ['Ps. Evolutiva Niñez'] },
        { name: 'Psicopatología', reqs: ['Neurofisiología', 'Ps. Evolutiva Adolescencia'] },
        { name: 'T. Y T de Explor. Diag. Ps. Mód I', reqs: ['Metodología de la Investigación', 'Psicopatología'] },
        { name: 'T. Y T de Explor. Diag. Ps. Mód II', reqs: ['T. Y T de Explor. Diag. Ps. Mód I'] },
        { name: 'Materia Electiva I' },
        { name: 'Requisito Idioma', reqs: ['Psicología General', 'Psicoanálisis Freud'] },
        { name: 'Materia Electiva II' }
      ],
      'Formación Profesional': [
        { name: 'Ps. Ética y DDHH', reqs: ['Psicología Social', 'Historia de la Psicología'] },
        { name: 'Psicología Educacional', reqs: ['Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'Ps. Evolutiva Adolescencia'] },
        { name: 'Psicología Institucional', reqs: ['Salud Pública y Mental', 'Teoría y Técnica de Grupos'] },
        { name: 'Psicología del Trabajo', reqs: ['Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'T. Y T de Explor. Diag. Ps. Mód II'] },
        { name: 'CP y P. Clínica de Adultos', reqs: ['T. Y T de Explor. Diag. Ps. Mód II'] },
        { name: 'Psicología Jurídica', reqs: ['T. Y T de Explor. Diag. Ps. Mód II'] },
        { name: 'Psicoterapias', reqs: ['T. Y T de Explor. Diag. Ps. Mód II'] },
        { name: 'Práctica prof. o de Investigación', reqs: [
          'Psicología General', 'Estadística', 'Psicología Social', 'Psicoanálisis Freud', 'Psic. Y Epist. Genética', 'Neurofisiología', 'Historia de la Psicología', 
          'Metodología de la Investigación', 'Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'Ps. Evolutiva Niñez', 'Ps. Evolutiva Adolescencia', 'Psicopatología',
          'T. Y T de Explor. Diag. Ps. Mód I', 'T. Y T de Explor. Diag. Ps. Mód II', 'Requisito Idioma'
        ] },
        { name: 'Materia Electiva/Práctica', reqs: [
          'Psicología General', 'Estadística', 'Psicología Social', 'Psicoanálisis Freud', 'Psic. Y Epist. Genética', 'Neurofisiología', 'Historia de la Psicología', 
          'Metodología de la Investigación', 'Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'Ps. Evolutiva Niñez', 'Ps. Evolutiva Adolescencia', 'Psicopatología',
          'T. Y T de Explor. Diag. Ps. Mód I', 'T. Y T de Explor. Diag. Ps. Mód II', 'Requisito Idioma'
        ] },
        { name: 'Materia Electiva III', reqs: [
          'Psicología General', 'Estadística', 'Psicología Social', 'Psicoanálisis Freud', 'Psic. Y Epist. Genética', 'Neurofisiología', 'Historia de la Psicología', 
          'Metodología de la Investigación', 'Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'Ps. Evolutiva Niñez', 'Ps. Evolutiva Adolescencia', 'Psicopatología',
          'T. Y T de Explor. Diag. Ps. Mód I', 'T. Y T de Explor. Diag. Ps. Mód II', 'Requisito Idioma'
        ] },
        { name: 'Materia Electiva IV', reqs: [
          'Psicología General', 'Estadística', 'Psicología Social', 'Psicoanálisis Freud', 'Psic. Y Epist. Genética', 'Neurofisiología', 'Historia de la Psicología', 
          'Metodología de la Investigación', 'Salud Pública y Mental', 'Teoría y Técnica de Grupos', 'Ps. Evolutiva Niñez', 'Ps. Evolutiva Adolescencia', 'Psicopatología',
          'T. Y T de Explor. Diag. Ps. Mód I', 'T. Y T de Explor. Diag. Ps. Mód II', 'Requisito Idioma'
        ] },
        { name: 'Requisito Tesis', reqs: [
          'Biología', 'Semiología', 'Psicología', 'Pensamiento científico', 'Matemática', 'Sociedad y Estado',
          'Psicología General', 'Estadística', 'Psicología Social', 'Psicoanálisis Freud', 'Psic. Y Epist. Genética',
          'Neurofisiología', 'Historia de la Psicología', 'Metodología de la Investigación', 'Salud Pública y Mental',
          'Teoría y Técnica de Grupos', 'Ps. Evolutiva Niñez', 'Ps. Evolutiva Adolescencia', 'Psicopatología',
          'T. Y T de Explor. Diag. Ps. Mód I', 'T. Y T de Explor. Diag. Ps. Mód II', 'Materia Electiva I',
          'Requisito Idioma', 'Materia Electiva II', 'Ps. Ética y DDHH', 'Psicología Educacional', 'Psicología Institucional',
          'Psicología del Trabajo', 'CP y P. Clínica de Adultos', 'Psicología Jurídica', 'Psicoterapias',
          'Práctica prof. o de Investigación', 'Materia Electiva/Práctica', 'Materia Electiva III', 'Materia Electiva IV'
        ] }
      ]
    };

    const completed = JSON.parse(localStorage.getItem('completedCourses') || '[]');

    function isCompleted(name) {
      return completed.includes(name);
    }

    function checkRequirements(reqs) {
      if (!reqs || reqs.length === 0) return true;
      return reqs.every(r => {
        if (r === 'CBC') {
          return data['CBC'].every(isCompleted);
        } else {
          return isCompleted(r);
        }
      });
    }

    function updateTesisProgress() {
      const tesis = data['Formación Profesional'].find(c => c.name === 'Requisito Tesis');
      if (!tesis) {
        document.getElementById('tesisProgress').textContent = '';
        return;
      }
      const total = tesis.reqs.length;
      const done = tesis.reqs.filter(isCompleted).length;
      document.getElementById('tesisProgress').textContent = `Progreso hacia Tesis: ${done}/${total} materias completadas`;
    }

    function render() {
      updateTesisProgress();
      const container = document.getElementById('curriculum');
      container.innerHTML = '';

      for (const [cycle, courses] of Object.entries(data)) {
        const col = document.createElement('div');
        // Crear clase para la columna sin acentos y espacios convertidos
        let className = cycle.toLowerCase()
          .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
          .replace(/\s+/g, '-');
        col.className = 'column ' + className;
        col.innerHTML = `<h2>${cycle}</h2>`;

        courses.forEach(course => {
          const name = typeof course === 'string' ? course : course.name;
          const reqs = typeof course === 'string' ? [] : course.reqs;
          const isDone = isCompleted(name);
          const unlocked = checkRequirements(reqs);

          const div = document.createElement('div');
          div.className = 'course';
          if (isDone) div.classList.add('completed');
          if (!unlocked) div.classList.add('locked');

          div.innerHTML = `${name}${isDone ? '<span class="checkmark">✓</span>' : ''}`;

          if (!unlocked && reqs.length) {
            const tooltip = document.createElement('span');
            tooltip.className = 'tooltip';
            const unmet = reqs.filter(r => r === 'CBC' ? !data['CBC'].every(isCompleted) : !isCompleted(r));
            tooltip.textContent = `Falta: ${unmet.join(', ')}`;
            div.appendChild(tooltip);
          }

          div.onclick = () => {
            if (!unlocked) return;
            if (isDone) {
              completed.splice(completed.indexOf(name), 1);
            } else {
              completed.push(name);
            }
            localStorage.setItem('completedCourses', JSON.stringify(completed));
            render();
          };

          col.appendChild(div);
        });

        container.appendChild(col);
      }
    }

    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
      // Cambiar texto botón
      const btn = document.getElementById('darkModeBtn');
      btn.textContent = document.body.classList.contains('dark-mode') ? 'Modo claro' : 'Modo oscuro';
    }

    // Restaurar modo oscuro si estaba activado
    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
    }

    // Ajustar texto botón al cargar
    document.getElementById('darkModeBtn').textContent = document.body.classList.contains('dark-mode') ? 'Modo claro' : 'Modo oscuro';

    document.getElementById('darkModeBtn').addEventListener('click', toggleDarkMode);

    render();
  </script>
</body>
</html>
